<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πâ‡∏á - Election Verification Dashboard</title>
    
    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- Leaflet for maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- D3.js for advanced visualizations -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --danger: #f5576c;
            --warning: #ffc107;
            --success: #28a745;
            --info: #17a2b8;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
        }
        
        .header h1 {
            color: var(--primary);
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #666;
            font-size: 1.1em;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .stat-card .icon {
            font-size: 2.5em;
            margin-bottom: 15px;
        }
        
        .stat-card .number {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .stat-card .label {
            color: #666;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .stat-card.identical .number { color: var(--success); }
        .stat-card.minor .number { color: var(--warning); }
        .stat-card.significant .number { color: #ff6b6b; }
        .stat-card.critical .number { color: var(--danger); }
        
        .viz-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .viz-section h2 {
            color: var(--primary);
            margin-bottom: 20px;
            border-left: 5px solid var(--primary);
            padding-left: 15px;
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 20px;
        }
        
        .map-container {
            height: 500px;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        select, input {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
        }
        
        select:focus, input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .alert {
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid;
        }
        
        .alert-info {
            background: #d1ecf1;
            border-color: var(--info);
            color: #0c5460;
        }
        
        .alert-warning {
            background: #fff3cd;
            border-color: var(--warning);
            color: #856404;
        }
        
        .alert-danger {
            background: #f8d7da;
            border-color: var(--danger);
            color: #721c24;
        }
        
        .table-responsive {
            overflow-x: auto;
            margin-top: 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        table th, table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        
        table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #555;
        }
        
        table tr:hover {
            background: #f8f9fa;
        }
        
        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }
        
        .badge-success { background: #d4edda; color: #155724; }
        .badge-warning { background: #fff3cd; color: #856404; }
        .badge-danger { background: #f8d7da; color: #721c24; }
        .badge-critical { background: var(--danger); color: white; }
        
        .loading {
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .footer {
            text-align: center;
            padding: 30px;
            color: white;
            margin-top: 50px;
        }
        
        .footer a {
            color: white;
            text-decoration: underline;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üîç ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πâ‡∏á 2569</h1>
            <p>Election Verification Dashboard - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å ‡∏Å‡∏Å‡∏ï. (‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Vote62 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö)</p>
            <p id="lastUpdate" style="color:#999;font-size:0.9em;margin-top:5px;"></p>
        </div>
        
        <!-- Statistics Cards -->
        <div class="stats-grid">
            <div class="stat-card" style="border-left:4px solid var(--primary)">
                <div class="icon">üó≥Ô∏è</div>
                <div class="number" id="stat-turnout">-</div>
                <div class="label">‡∏ú‡∏π‡πâ‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥</div>
            </div>
            <div class="stat-card" style="border-left:4px solid var(--success)">
                <div class="icon">üìç</div>
                <div class="number" id="stat-units">-</div>
                <div class="label">‡πÄ‡∏Ç‡∏ï‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πâ‡∏á</div>
            </div>
            <div class="stat-card" style="border-left:4px solid var(--info)">
                <div class="icon">ÔøΩ</div>
                <div class="number" id="stat-percent">-</div>
                <div class="label">‡∏ô‡∏±‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏•‡πâ‡∏ß (%)</div>
            </div>
            <div class="stat-card" style="border-left:4px solid var(--warning)">
                <div class="icon">‚úÖ</div>
                <div class="number" id="stat-valid">-</div>
                <div class="label">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</div>
            </div>
        </div>
        
        <!-- Controls -->
        <div class="viz-section">
            <h2>üéõÔ∏è ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</h2>
            <div class="controls">
                <select id="provinceSelect" onchange="filterByProvince()">
                    <option value="all">‡∏ó‡∏∏‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</option>
                </select>
                
                <select id="chartType">
                    <option value="overview">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</option>
                    <option value="comparison">‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏£‡∏≤‡∏¢‡∏û‡∏£‡∏£‡∏Ñ</option>
                    <option value="timeline">Timeline</option>
                    <option value="heatmap">Heatmap</option>
                </select>
                
                <button class="btn btn-primary" onclick="loadData()">üîÑ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                <button class="btn btn-primary" onclick="exportData()">üì• Export CSV</button>
            </div>
            
            <div class="alert alert-info">
                <strong>‚ÑπÔ∏è ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå JSON ‡∏ó‡∏µ‡πà‡∏ß‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡πÉ‡∏ô GitHub Pages 
                (‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£ push ‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà)
            </div>
        </div>
        
        <!-- Chart: Overview -->
        <div class="viz-section">
            <h2>üìä ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏û‡∏£‡∏£‡∏Ñ (Top 10)</h2>
            <div class="chart-container">
                <canvas id="overviewChart"></canvas>
            </div>
        </div>
        
        <!-- Chart: Party Comparison -->
        <div class="viz-section">
            <h2>üèõÔ∏è ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏û‡∏£‡∏£‡∏Ñ (‡πÄ‡∏Ç‡∏ï vs ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠)</h2>
            <div class="chart-container">
                <canvas id="partyChart"></canvas>
            </div>
        </div>
        
        <!-- Chart: Turnout Distribution -->
        <div class="viz-section">
            <h2>üìà ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥ (%)</h2>
            <div class="chart-container">
                <canvas id="distributionChart"></canvas>
            </div>
        </div>
        
        <!-- Map -->
        <div class="viz-section">
            <h2>üó∫Ô∏è ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥</h2>
            <div class="map-container" id="map"></div>
        </div>
        
        <!-- Detailed Results Table -->
        <div class="viz-section">
            <h2>üìã ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö</h2>
            <div class="table-responsive">
                <table id="resultsTable">
                    <thead>
                        <tr>
                            <th>‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏Ç‡∏ï</th>
                            <th>‡πÄ‡∏Ç‡∏ï‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πâ‡∏á</th>
                            <th>‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞ ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö 1</th>
                            <th>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th>
                            <th>‡∏ú‡∏π‡πâ‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥</th>
                            <th>‡∏ô‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß (%)</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <!-- Data will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Critical Units Alert -->
        <div id="criticalAlert" style="display:none;">
            <div class="viz-section">
                <div class="alert alert-danger">
                    <h3 style="margin-bottom: 15px;">üö® ‡∏û‡∏ö‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á!</h3>
                    <div id="criticalList"></div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <p>‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÇ‡∏î‡∏¢ Election Verification System Team</p>
        <p>#‡∏ô‡∏±‡∏ö‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏® #‡∏£‡∏∞‡∏ö‡∏≠‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏î‡πâ‡∏≤‡∏ô</p>
        <p>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å: <a href="https://www.ect.go.th">‡∏Å‡∏Å‡∏ï.</a> ‡πÅ‡∏•‡∏∞ <a href="https://vote62.com">Vote62.com</a></p>
    </div>

    <script>
        // Global variables
        let map;
        let charts = {};
        let data = null;
        let filteredUnits = [];
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initMap();
            loadData();
        });
        
        // Load data from JSON file
        function loadData() {
            fetch('data/election_data.json')
                .then(r => {
                    if (!r.ok) throw new Error('HTTP ' + r.status);
                    return r.json();
                })
                .then(json => {
                    data = json;
                    filteredUnits = data.units;
                    populateProvinceFilter();
                    updateUI();
                })
                .catch(err => {
                    console.error('Failed to load data:', err);
                    document.getElementById('lastUpdate').textContent = 
                        '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: ' + err.message;
                });
        }
        
        // Populate province dropdown
        function populateProvinceFilter() {
            const sel = document.getElementById('provinceSelect');
            if (!data || !data.provinces) return;
            const provs = Object.values(data.provinces).sort((a,b) => a.name.localeCompare(b.name, 'th'));
            provs.forEach(p => {
                const opt = document.createElement('option');
                opt.value = p.prov_id;
                opt.textContent = p.name + ' (' + p.units + ' ‡πÄ‡∏Ç‡∏ï)';
                sel.appendChild(opt);
            });
        }
        
        // Filter by province
        function filterByProvince() {
            const val = document.getElementById('provinceSelect').value;
            if (val === 'all') {
                filteredUnits = data.units;
            } else {
                filteredUnits = data.units.filter(u => u.prov_id === val);
            }
            updateTable();
        }
        
        // Update all UI components
        function updateUI() {
            if (!data) return;
            updateStats();
            updateCharts();
            updateMap();
            updateTable();
        }
        
        // Update statistics cards
        function updateStats() {
            const ns = data.metadata.national_stats || {};
            document.getElementById('stat-turnout').textContent = 
                (ns.turn_out || 0).toLocaleString();
            document.getElementById('stat-units').textContent = 
                (data.metadata.total_units || 0).toLocaleString();
            document.getElementById('stat-percent').textContent = 
                (ns.percent_count || 0).toFixed(2) + '%';
            document.getElementById('stat-valid').textContent = 
                (ns.valid_votes || 0).toLocaleString();
            
            if (data.metadata.last_update) {
                const d = new Date(data.metadata.last_update);
                document.getElementById('lastUpdate').textContent = 
                    '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ' + d.toLocaleString('th-TH');
            }
        }
        
        // Update charts
        function updateCharts() {
            createOverviewChart();
            createPartyChart();
            createDistributionChart();
        }
        
        // Overview Chart - Top 10 parties by constituency votes
        function createOverviewChart() {
            const ctx = document.getElementById('overviewChart').getContext('2d');
            if (charts.overview) charts.overview.destroy();
            
            const np = data.national_parties || [];
            const labels = np.map(p => p.name);
            const votes = np.map(p => p.cons_votes);
            const colors = np.map(p => p.color || '#667eea');
            
            charts.overview = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏Ç‡∏ï',
                        data: votes,
                        backgroundColor: colors
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏û‡∏£‡∏£‡∏Ñ (‡πÄ‡∏Ç‡∏ï‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πâ‡∏á) - Top 10'
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: {
                                callback: v => (v/1000000).toFixed(1) + 'M'
                            }
                        }
                    }
                }
            });
        }
        
        // Party Chart - Constituency vs Party List votes
        function createPartyChart() {
            const ctx = document.getElementById('partyChart').getContext('2d');
            if (charts.party) charts.party.destroy();
            
            const np = data.national_parties || [];
            const labels = np.map(p => p.name);
            const consVotes = np.map(p => p.cons_votes);
            const listVotes = np.map(p => p.party_list_votes);
            
            charts.party = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏Ç‡∏ï',
                            data: consVotes,
                            backgroundColor: 'rgba(102,126,234,0.8)'
                        },
                        {
                            label: '‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠',
                            data: listVotes,
                            backgroundColor: 'rgba(245,87,108,0.8)'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: '‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏Ç‡∏ï vs ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: v => (v/1000000).toFixed(1) + 'M'
                            }
                        }
                    }
                }
            });
        }
        
        // Distribution Chart - Turnout distribution
        function createDistributionChart() {
            const ctx = document.getElementById('distributionChart').getContext('2d');
            if (charts.distribution) charts.distribution.destroy();
            
            const turnouts = data.units.map(u => u.percent_turn_out || 0);
            const bins = [0, 50, 55, 60, 65, 70, 75, 80, 100];
            const binLabels = ['<50%', '50-55%', '55-60%', '60-65%', '65-70%', '70-75%', '75-80%', '80%+'];
            const counts = new Array(bins.length - 1).fill(0);
            
            turnouts.forEach(t => {
                for (let i = 0; i < bins.length - 1; i++) {
                    if (t >= bins[i] && t < bins[i + 1]) {
                        counts[i]++;
                        break;
                    }
                }
            });
            
            charts.distribution = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: binLabels,
                    datasets: [{
                        label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏Ç‡∏ï',
                        data: counts,
                        backgroundColor: '#667eea'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: '‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥ (% ‡∏ï‡πà‡∏≠‡πÄ‡∏Ç‡∏ï)'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏Ç‡∏ï' }
                        },
                        x: {
                            title: { display: true, text: '‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥' }
                        }
                    }
                }
            });
        }
        
        // Initialize map
        function initMap() {
            map = L.map('map').setView([13.7563, 100.5018], 6);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors'
            }).addTo(map);
        }
        
        // Update map (placeholder - no lat/lng in current data)
        function updateMap() {
            // Map markers will be added when we have lat/lng data
        }
        
        // Update table
        function updateTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            
            filteredUnits.forEach(unit => {
                const row = tbody.insertRow();
                const winnerStyle = unit.winner_color ? 
                    `style="color:${unit.winner_color};font-weight:bold"` : '';
                row.innerHTML = `
                    <td>${unit.unit_id}</td>
                    <td>${unit.constituency}</td>
                    <td ${winnerStyle}>${unit.winner || '-'}</td>
                    <td>${(unit.winner_votes || 0).toLocaleString()}</td>
                    <td>${(unit.turn_out || 0).toLocaleString()}</td>
                    <td>${(unit.percent_count || 0).toFixed(1)}%</td>
                `;
            });
        }
        
        // Export data
        function exportData() {
            if (!data) return;
            const headers = ['‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏Ç‡∏ï', '‡πÄ‡∏Ç‡∏ï‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πâ‡∏á', '‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î', '‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞', '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞', 
                '‡∏ú‡∏π‡πâ‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥', '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', '‡∏ô‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß(%)'];
            const rows = filteredUnits.map(u => [
                u.unit_id,
                '"' + u.constituency + '"',
                '"' + u.province + '"',
                '"' + (u.winner || '') + '"',
                u.winner_votes || 0,
                u.turn_out || 0,
                u.valid_votes || 0,
                (u.percent_count || 0).toFixed(1)
            ]);
            
            let csv = headers.join(',') + '\n';
            rows.forEach(row => { csv += row.join(',') + '\n'; });
            
            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'election_data_' + new Date().toISOString().split('T')[0] + '.csv';
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>
